# ğŸ¦— grasshopper
[![GoDoc][1]][2] [![MIT licensed][3]][4] [![Created At][5]][6] [![Go Report Card][7]][8] [![Release][9]][10]

[1]: https://godoc.org/github.com/xtaci/grasshopper?status.svg
[2]: https://pkg.go.dev/github.com/xtaci/grasshopper
[3]: https://img.shields.io/badge/license-MIT-blue.svg
[4]: LICENSE
[5]: https://img.shields.io/github/created-at/xtaci/grasshopper
[6]: https://img.shields.io/github/created-at/xtaci/grasshopper
[7]: https://goreportcard.com/badge/github.com/xtaci/grasshopper
[8]: https://goreportcard.com/report/github.com/xtaci/grasshopper
[9]: https://img.shields.io/github/v/release/xtaci/grasshopper?color=orange
[10]: https://github.com/xtaci/grasshopper/releases/latest

[English](README.md) | [ä¸­æ–‡](README_zh.md)

**Grasshopper** æ˜¯ä¸€æ¬¾è½»é‡çº§ UDP æ•°æ®åŒ…è½¬å‘å™¨ï¼Œè´Ÿè´£ç›‘å¬å…¥ç«™æ•°æ®åŒ…å¹¶å°†å…¶è·¯ç”±åˆ°é¢„å…ˆé…ç½®çš„ç›®æ ‡èŠ‚ç‚¹ã€‚å®ƒèƒ½å¤Ÿåœ¨å…¥ç«™ä¸å‡ºç«™é“¾è·¯ä¸Šåˆ†åˆ«åº”ç”¨ç‹¬ç«‹çš„å¯†é’¥å’ŒåŠ å¯†ç®—æ³•ï¼Œæ—¢å¯å®ç°ç«¯åˆ°ç«¯åŠ å¯†ï¼Œä¹Ÿå¯åœ¨å„è·³ä¹‹é—´çµæ´»åˆ‡æ¢å®‰å…¨ç­–ç•¥ã€‚

## æ¶æ„
Grasshopper ä»¥â€œè·³ç‚¹é“¾â€æ–¹å¼ä¸²è”å¤šä¸ªä¸­ç»§èŠ‚ç‚¹ï¼Œèƒ½å¤Ÿåœ¨ä¸åŒé“¾è·¯ä¸Šè¿›è¡Œé‡æ–°åŠ å¯†æˆ–è§£å¯†ã€‚ä»¥ä¸‹ç¤ºä¾‹å±•ç¤ºäº†ä¸€ä¸ªå¤šè·³ DNS æŸ¥è¯¢æµç¨‹ï¼š
```
                      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                 
                      â”‚ ENCRYPTED  â”‚                 â”‚ RE-ENCRYPTION â”‚                                 
                      â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜                 â”‚ AES â”€â”€â”€â–º 3DES â”‚                                 
                             â”‚                       â””â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                 
                             â”‚                           â”‚                                             
                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”â–¼             â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚             â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”                     
                <HOP0>   HOPS(AES)         â”‚  DECRYPTED â”‚â–¼          <HOP5>      HOPS(FINAL)            
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â””       â”Œâ”€â”€â”€â”€â”           â””  DATA   HOPS(3DES)        â”‚       â”Œâ”€â”´â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ dig xxx â”œâ”€â–º CLEAR TEXT  â”‚HOP1â”¼â”€â”€ CIPHER â”€â”€â–º PACKET  â”Œâ”€â”´â”€â”€â”           â”” DNS   â”‚Hop6â”œâ”€â–º 8.8.8.8:53 â”‚
â”‚ @hop0   â”‚       â”Œ       â”‚Hop2â”‚   (AES)   â”Œ          â”‚Hop4â”œâ”€ CIPHER â”€â”€â–º QUERY â”‚Hop7â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚  â–²    â”‚HOP3â”‚         <HOP2>  â–²    â”‚Hop5â”‚  (3DES)   â”Œ       â””â”€â”¬â”€â”€â”˜                  
                  â”‚  â”‚    â””â”€â”€â”€â”€â”˜           â”‚     â”‚    â””â”€â”¬â”€â”€â”˜           â”‚         â”‚                     
                  â””â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”˜              â””â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”˜              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                     
                     â”‚                           â”‚                                                     
                  â”Œâ”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”‚                                                     
                  â”‚           â”‚                  â”‚                                                     
                  â”‚ OPTIONAL  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                                     
                  â”‚ PACKET    â”‚                                                                        
                  â”‚ PROCESSOR â”‚                                                                        
                  â”‚           â”‚                                                                        
                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                                                        
```

## å®‰è£…

ä½¿ç”¨ Go å·¥å…·é“¾å¯ç›´æ¥è·å–æœ€æ–°å‘è¡Œç‰ˆï¼š

```sh
go install  github.com/xtaci/grasshopper/cmd/grasshopper@latest     
```

## å‚æ•°
è¿è¡Œ `grasshopper --help` å¯è·å–å®Œæ•´è¯´æ˜ï¼Œæ ¸å¿ƒé€‰é¡¹å¦‚ä¸‹ï¼š

```text
Grasshopper æ˜¯ä¸€ä¸ª UDP æ•°æ®åŒ…è½¬å‘å™¨ï¼Œå®ƒç›‘å¬ä¼ å…¥çš„æ•°æ®åŒ…å¹¶å°†å…¶è½¬å‘åˆ°é…ç½®çš„ç›®æ ‡åœ°å€ã€‚å®ƒæ”¯æŒå¯¹ä¼ å…¥å’Œä¼ å‡ºçš„æ•°æ®åŒ…è¿›è¡ŒåŠ å¯†ï¼Œå¹¶ä¸”å¯ä»¥ä½¿ç”¨ä¸åŒçš„å¯†é’¥å’ŒåŠ å¯†æ–¹æ³•ã€‚

ç”¨æ³•:
  grasshopper [command]

å¯ç”¨å‘½ä»¤:
  completion  ä¸ºæŒ‡å®š shell ç”Ÿæˆè‡ªåŠ¨è¡¥å…¨è„šæœ¬
  help        æŸ¥çœ‹ä»»æ„å‘½ä»¤çš„å¸®åŠ©ä¿¡æ¯
  start       å¯åŠ¨ UDP ä¸­ç»§ç›‘å¬å™¨

æ ‡å¿—:
      --ci string          å…¥ç«™æ•°æ®çš„è§£å¯†ç®—æ³•ã€‚å¯é€‰: aes, aes-128, aes-192, qpp, salsa20, blowfish, twofish, cast5, 3des, tea, xtea, sm4, none (é»˜è®¤ "qpp")
      --co string          å‡ºç«™æ•°æ®çš„åŠ å¯†ç®—æ³•ã€‚å¯é€‰: aes, aes-128, aes-192, qpp, salsa20, blowfish, twofish, cast5, 3des, tea, xtea, sm4, none (é»˜è®¤ "qpp")
  -c, --config string      é…ç½®æ–‡ä»¶è·¯å¾„
  -h, --help               æ˜¾ç¤ºå¸®åŠ©
      --ki string          å®¢æˆ·ç«¯ä¾§ï¼ˆæœ€åä¸€è·³ï¼‰å¤ç”¨çš„å¯†é’¥ (é»˜è®¤ "it's a secret")
      --ko string          ä¸‹ä¸€è·³ä½¿ç”¨çš„å¯†é’¥ (é»˜è®¤ "it's a secret")
  -l, --listen string      ç›‘å¬åœ°å€ï¼Œä¾‹å¦‚ "IP:1234" (é»˜è®¤ ":1234")
  -n, --nexthops strings   ä¸‹ä¸€è·³æœåŠ¡å™¨åˆ—è¡¨ï¼ŒæŒ‰å“ˆå¸Œéšæœºè½¬å‘ (é»˜è®¤ [127.0.0.1:3000])
      --sockbuf int        ç›‘å¬å¥—æ¥å­—ç¼“å†²åŒºå¤§å° (é»˜è®¤ 1048576)
      --timeout duration   UDP è¿æ¥ç©ºé—²è¶…æ—¶æ—¶é—´ (é»˜è®¤ 1m0s)
  -t, --toggle             åˆ‡æ¢å¸®åŠ©ä¿¡æ¯
  -v, --version            è¾“å‡ºç‰ˆæœ¬å·

ä½¿ç”¨ "grasshopper [command] --help" æ·±å…¥äº†è§£å…·ä½“å‘½ä»¤ã€‚
```

## åŠ å¯†ç®—æ³•æ”¯æŒ
- SM4 ([å›½å¯†](https://en.wikipedia.org/wiki/SM4_(cipher)))
- AES ([Advanced Encryption Standard](https://en.wikipedia.org/wiki/Advanced_Encryption_Standard)), 128, 192, 256-bit
- QPP ([Quantum Permutation Pad](https://epjquantumtechnology.springeropen.com/articles/10.1140/epjqt/s40507-022-00145-y))
- Salsa20 (https://en.wikipedia.org/wiki/Salsa20)
- Blowfish (https://en.wikipedia.org/wiki/Blowfish_(cipher))
- Twofish (https://en.wikipedia.org/wiki/Twofish)
- Cast5 (https://en.wikipedia.org/wiki/CAST-128)
- 3DES (https://en.wikipedia.org/wiki/Triple_DES)
- Tea ([Tiny Encryption Algorithm](https://en.wikipedia.org/wiki/Tiny_Encryption_Algorithm))
- XTea (https://en.wikipedia.org/wiki/XTEA)

## ä½¿ç”¨æ¡ˆä¾‹

### æ¡ˆä¾‹ I: å®‰å…¨å›æ˜¾ (Secure Echo)

æµç¨‹é€Ÿè§ˆï¼š

```
å®¢æˆ·ç«¯ (ncat @127.0.0.1:4000)
  â”‚ æ˜æ–‡
  â–¼
ä¸€çº§ä¸­ç»§ (ci=none, co=aes) â”€â”€ AES å¯†æ–‡ â”€â”€â–º äºŒçº§ä¸­ç»§ (ci=aes, co=none) â”€â”€â–º UDP echo @127.0.0.1:5000
```

è¯»è€…åªéœ€è®°ä½ï¼šç»ˆç«¯åªè¿ `127.0.0.1:4000`ï¼Œå‡ºç«™åœ¨ä¸€çº§ä¸­ç»§è¢«åŠ å¯†ï¼Œåˆ°äºŒçº§ä¸­ç»§è§£å¯†åå†é€å¾€ echo æœåŠ¡å™¨ã€‚

#### æ­¥éª¤ 1: å¯åŠ¨ UDP Echo æœåŠ¡å™¨

å€ŸåŠ© `ncat` åœ¨ 5000 ç«¯å£å¯åŠ¨ä¸€ä¸ª UDP echo æœåŠ¡å™¨ï¼š

```sh
ncat -e /bin/cat -k -u -l 5000
```
#### æ­¥éª¤ 2: å¯åŠ¨åˆ° Echo æœåŠ¡å™¨çš„äºŒçº§ä¸­ç»§

è¿è¡Œä»¥ä¸‹å‘½ä»¤å¯åŠ¨ä¸­ç»§èŠ‚ç‚¹ï¼š

```sh
./grasshopper start --ci aes --co none -l "127.0.0.1:4001" -n "127.0.0.1:5000"
```

- `--ci aes`: æŒ‰ AES è§£å¯†æ¥è‡ªä¸Šä¸€è·³çš„æ•°æ®åŒ…ã€‚
- `--co none`: å‘ `ncat` echo æœåŠ¡å™¨è½¬å‘æ˜æ–‡ã€‚

#### æ­¥éª¤ 3: å¯åŠ¨åˆ°äºŒçº§ä¸­ç»§çš„ä¸€çº§ä¸­ç»§

æ‰§è¡Œä¸‹åˆ—å‘½ä»¤å¯åŠ¨ç¬¬ä¸€è·³ï¼š

```sh
./grasshopper start --ci none --co aes -l "127.0.0.1:4000" -n "127.0.0.1:4001"
```

- `--ci none`: å…¥ç«™æ•°æ®ä¸ºæ˜æ–‡ï¼Œç›´æ¥é€ä¼ ã€‚
- `--co aes`: ä½¿ç”¨ AES åŠ å¯†åå†é€å¾€ä¸‹ä¸€è·³ã€‚

#### æ­¥éª¤ 4: å¯åŠ¨æ¼”ç¤ºå®¢æˆ·ç«¯

ä½¿ç”¨ `ncat` å‘é€ UDP æ•°æ®åŒ…ï¼Œä¸å¤šè·³é“¾è·¯äº¤äº’ï¼š

```sh
ncat -u 127.0.0.1 4000
```

### æ¡ˆä¾‹ II: å®‰å…¨ DNS æŸ¥è¯¢ (éšæœºé€‰æ‹©)
æµç¨‹é€Ÿè§ˆï¼ˆåŒè·³è½¬å‘ã€éšæœºä¸Šæ¸¸ï¼‰ï¼š

```
æœ¬åœ° dig â”€â”€â–º ä¸€çº§ä¸­ç»§ (ci=none, co=aes) â”€â”€ AES å¯†æ–‡è·¨ç½‘ â”€â”€â–º äºŒçº§ä¸­ç»§ (ci=aes, co=none) â”€â”€â–º DNS æ±  {8.8.8.8, 1.1.1.1}
```

æœ¬åœ°åªéœ€è¯·æ±‚ `127.0.0.1:4000`ï¼›è·¨å…¬ç½‘çš„é‚£ä¸€è·³ä¿æŒåŠ å¯†ï¼ŒäºŒçº§ä¸­ç»§ä¼šä¸ºæ¯æ¬¡æŸ¥è¯¢åœ¨ä¸Šæ¸¸æ± é‡ŒéšæœºæŒ‘é€‰ä¸€ä¸ª DNSã€‚
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ YOURâ”€LAPTOP â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ CLOUDâ”€SERVER â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                       â”‚           â”‚                                   â”‚
â”‚                                       â”‚           â”‚                                   â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚           â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚ â”‚                   â”‚   â”‚          â”‚  â”‚           â”‚ â”‚          â”‚   â”‚               â”‚  â”‚
â”‚ â”‚ dig google.com    â”œâ”€â”€â”€â–º Level-1  â”‚  â”‚           â”‚ â”‚ Level-2  â”œâ”€â”€â”€â–º Google DNS:53 â”‚  â”‚
â”‚ â”‚ @127.0.0.1 -p 4000â”‚   â”‚ Relayer  â”¼â”€â”€â”¼ ENCRYPTED â”¼â”€â–º Relayer  â”‚   â”‚ CloudFlare:53 â”‚  â”‚
â”‚ â”‚                   â”‚   â”‚          â”‚  â”‚    UDP    â”‚ â”‚          â”‚   â”‚               â”‚  â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚           â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                       â”‚           â”‚                                   â”‚
â”‚                                       â”‚           â”‚                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```
#### æ­¥éª¤ 1: å¯åŠ¨åˆ° DNS æœåŠ¡å™¨çš„äºŒçº§ä¸­ç»§ (äº‘æœåŠ¡å™¨ ğŸ–¥ï¸)

```sh
./grasshopper start --ci aes --co none -l "CLOUD_PUBLIC_IP:4000" -n "8.8.8.8:53,1.1.1.1:53"
```

- `--ci aes`: å¯¹æ¥è‡ªä¸€çº§ä¸­ç»§çš„å¯†æ–‡è¿›è¡Œè§£å¯†ï¼ˆ`ci` = cipher-inï¼‰ã€‚
- `--co none`: ä»¥æ˜æ–‡å½¢å¼å°†æŸ¥è¯¢æŠ•é€’è‡³ä¸Šæ¸¸ DNSï¼ˆ`co` = cipher-outï¼‰ã€‚

#### æ­¥éª¤ 2: å¯åŠ¨åˆ°äºŒçº§ä¸­ç»§çš„ä¸€çº§ä¸­ç»§ (æœ¬åœ°ç”µè„‘ ğŸ’»)

```sh
./grasshopper start --ci none --co aes -l "127.0.0.1:4000" -n "CLOUD_PUBLIC_IP:4000"
```

- `--ci none`: æœ¬åœ° `dig` æŸ¥è¯¢ä¸ºæ˜æ–‡ï¼Œæ— éœ€è§£å¯†ã€‚
- `--co aes`: å°† DNS æŸ¥è¯¢åŠ å¯†åå‘å¾€äº‘ç«¯ã€‚

#### æ­¥éª¤ 3: ä½¿ç”¨ `dig` æŸ¥è¯¢ä¸€çº§ä¸­ç»§ (æœ¬åœ°ç”µè„‘ ğŸ’»)

```sh
dig google.com @127.0.0.1 -p 4000
```
