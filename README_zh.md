# ğŸ¦— grasshopper
[![GoDoc][1]][2] [![MIT licensed][3]][4] [![Created At][5]][6] [![Go Report Card][7]][8] [![Release][9]][10]

[1]: https://godoc.org/github.com/xtaci/grasshopper?status.svg
[2]: https://pkg.go.dev/github.com/xtaci/grasshopper
[3]: https://img.shields.io/badge/license-MIT-blue.svg
[4]: LICENSE
[5]: https://img.shields.io/github/created-at/xtaci/grasshopper
[6]: https://img.shields.io/github/created-at/xtaci/grasshopper
[7]: https://goreportcard.com/badge/github.com/xtaci/grasshopper
[8]: https://goreportcard.com/report/github.com/xtaci/grasshopper
[9]: https://img.shields.io/github/v/release/xtaci/grasshopper?color=orange
[10]: https://github.com/xtaci/grasshopper/releases/latest

[English](README.md) | [ä¸­æ–‡](README_zh.md)

**Grasshopper** æ˜¯ä¸€ä¸ª UDP æ•°æ®åŒ…è½¬å‘å™¨ï¼Œå®ƒç›‘å¬ä¼ å…¥çš„æ•°æ®åŒ…å¹¶å°†å…¶è½¬å‘åˆ°é…ç½®çš„ç›®æ ‡åœ°å€ã€‚å®ƒæ”¯æŒå¯¹ä¼ å…¥å’Œä¼ å‡ºçš„æ•°æ®åŒ…è¿›è¡ŒåŠ å¯†ï¼Œå¹¶ä¸”å¯ä»¥ä½¿ç”¨ä¸åŒçš„å¯†é’¥å’ŒåŠ å¯†æ–¹æ³•ã€‚

## æ¶æ„
Grasshopper ä½œä¸ºä¸€ä¸ªé“¾å¼ä¸­ç»§ç³»ç»Ÿè¿è¡Œã€‚ä¾‹å¦‚ï¼Œè€ƒè™‘ä¸€ä¸ªé“¾å¼ DNS æŸ¥è¯¢ï¼š
```
                      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                 
                      â”‚ ENCRYPTED  â”‚                 â”‚ RE-ENCRYPTION â”‚                                 
                      â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜                 â”‚ AES â”€â”€â”€â–º 3DES â”‚                                 
                             â”‚                       â””â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                 
                             â”‚                           â”‚                                             
                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”â–¼             â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚             â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”                     
                <HOP0>   HOPS(AES)         â”‚  DECRYPTED â”‚â–¼          <HOP5>      HOPS(FINAL)            
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â””       â”Œâ”€â”€â”€â”€â”           â””  DATA   HOPS(3DES)        â”‚       â”Œâ”€â”´â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ dig xxx â”œâ”€â–º CLEAR TEXT  â”‚HOP1â”¼â”€â”€ CIPHER â”€â”€â–º PACKET  â”Œâ”€â”´â”€â”€â”           â”” DNS   â”‚Hop6â”œâ”€â–º 8.8.8.8:53 â”‚
â”‚ @hop0   â”‚       â”Œ       â”‚Hop2â”‚   (AES)   â”Œ          â”‚Hop4â”œâ”€ CIPHER â”€â”€â–º QUERY â”‚Hop7â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚  â–²    â”‚HOP3â”‚         <HOP2>  â–²    â”‚Hop5â”‚  (3DES)   â”Œ       â””â”€â”¬â”€â”€â”˜                  
                  â”‚  â”‚    â””â”€â”€â”€â”€â”˜           â”‚     â”‚    â””â”€â”¬â”€â”€â”˜           â”‚         â”‚                     
                  â””â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”˜              â””â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”˜              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                     
                     â”‚                           â”‚                                                     
                  â”Œâ”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”‚                                                     
                  â”‚           â”‚                  â”‚                                                     
                  â”‚ OPTIONAL  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                                     
                  â”‚ PACKET    â”‚                                                                        
                  â”‚ PROCESSOR â”‚                                                                        
                  â”‚           â”‚                                                                        
                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                                                        
```

## å®‰è£…

è¦å®‰è£…æœ€æ–°ç‰ˆæœ¬çš„ Grasshopperï¼Œè¯·ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ï¼š

```sh
go install  github.com/xtaci/grasshopper/cmd/grasshopper@latest     
```

## å‚æ•°
Grasshopper æ”¯æŒä»¥ä¸‹å‘½ä»¤è¡Œå‚æ•°ï¼š

```text
Grasshopper æ˜¯ä¸€ä¸ª UDP æ•°æ®åŒ…è½¬å‘å™¨ï¼Œå®ƒç›‘å¬ä¼ å…¥çš„æ•°æ®åŒ…å¹¶å°†å…¶è½¬å‘åˆ°é…ç½®çš„ç›®æ ‡åœ°å€ã€‚å®ƒæ”¯æŒå¯¹ä¼ å…¥å’Œä¼ å‡ºçš„æ•°æ®åŒ…è¿›è¡ŒåŠ å¯†ï¼Œå¹¶ä¸”å¯ä»¥ä½¿ç”¨ä¸åŒçš„å¯†é’¥å’ŒåŠ å¯†æ–¹æ³•ã€‚

ç”¨æ³•:
  grasshopper [command]

å¯ç”¨å‘½ä»¤:
  completion  ç”ŸæˆæŒ‡å®š shell çš„è‡ªåŠ¨è¡¥å…¨è„šæœ¬
  help        å…³äºä»»ä½•å‘½ä»¤çš„å¸®åŠ©ä¿¡æ¯
  start       å¯åŠ¨ UDP æ•°æ®åŒ…è½¬å‘ç›‘å¬å™¨

æ ‡å¿—:
      --ci string          ä¼ å…¥æ•°æ®çš„åŠ å¯†æ–¹æ³•ã€‚å¯ç”¨é€‰é¡¹: aes, aes-128, aes-192, qpp, salsa20, blowfish, twofish, cast5, 3des, tea, xtea, sm4, none (é»˜è®¤ "qpp")
      --co string          ä¼ å‡ºæ•°æ®çš„åŠ å¯†æ–¹æ³•ã€‚å¯ç”¨é€‰é¡¹: aes, aes-128, aes-192, qpp, salsa20, blowfish, twofish, cast5, 3des, tea, xtea, sm4, none (é»˜è®¤ "qpp")
  -c, --config string      é…ç½®æ–‡ä»¶å
  -h, --help               grasshopper çš„å¸®åŠ©ä¿¡æ¯
      --ki string          ç”¨äºæœ€åä¸€è·³ï¼ˆå®¢æˆ·ç«¯ä¾§ï¼‰åŠ å¯†å’Œè§£å¯†çš„å¯†é’¥ (é»˜è®¤ "it's a secret")
      --ko string          ç”¨äºä¸‹ä¸€è·³åŠ å¯†å’Œè§£å¯†çš„å¯†é’¥ (é»˜è®¤ "it's a secret")
  -l, --listen string      ç›‘å¬åœ°å€ï¼Œä¾‹å¦‚: "IP:1234" (é»˜è®¤ ":1234")
  -n, --nexthops strings   éšæœºè½¬å‘åˆ°çš„æœåŠ¡å™¨åˆ—è¡¨ (é»˜è®¤ [127.0.0.1:3000])
      --sockbuf int        ç›‘å¬å™¨çš„å¥—æ¥å­—ç¼“å†²åŒºå¤§å° (é»˜è®¤ 1048576)
      --timeout duration   UDP è¿æ¥çš„ç©ºé—²è¶…æ—¶æ—¶é—´ (é»˜è®¤ 1m0s)
  -t, --toggle             åˆ‡æ¢å¸®åŠ©ä¿¡æ¯
  -v, --version            grasshopper çš„ç‰ˆæœ¬ä¿¡æ¯

ä½¿ç”¨ "grasshopper [command] --help" è·å–æœ‰å…³å‘½ä»¤çš„æ›´å¤šä¿¡æ¯ã€‚
```

## åŠ å¯†ç®—æ³•æ”¯æŒ
- SM4 ([å›½å¯†](https://en.wikipedia.org/wiki/SM4_(cipher)))
- AES ([Advanced Encryption Standard](https://en.wikipedia.org/wiki/Advanced_Encryption_Standard)), 128, 192, 256-bit
- QPP ([Quantum Permutation Pad](https://epjquantumtechnology.springeropen.com/articles/10.1140/epjqt/s40507-022-00145-y))
- Salsa20 (https://en.wikipedia.org/wiki/Salsa20)
- Blowfish (https://en.wikipedia.org/wiki/Blowfish_(cipher))
- Twofish (https://en.wikipedia.org/wiki/Twofish)
- Cast5 (https://en.wikipedia.org/wiki/CAST-128)
- 3DES (https://en.wikipedia.org/wiki/Triple_DES)
- Tea ([Tiny Encryption Algorithm](https://en.wikipedia.org/wiki/Tiny_Encryption_Algorithm))
- XTea (https://en.wikipedia.org/wiki/XTEA)

## ä½¿ç”¨æ¡ˆä¾‹

### æ¡ˆä¾‹ I: å®‰å…¨å›æ˜¾ (Secure Echo)

### æ­¥éª¤ 1: å¯åŠ¨ UDP Echo æœåŠ¡å™¨

ä½¿ç”¨ `ncat` åœ¨ç«¯å£ 5000 ä¸Šå¯åŠ¨ä¸€ä¸ª UDP echo æœåŠ¡å™¨ï¼š

```sh
ncat -e /bin/cat -k -u -l 5000
```
### æ­¥éª¤ 2: å¯åŠ¨åˆ° Echo æœåŠ¡å™¨çš„äºŒçº§ä¸­ç»§

è¿è¡Œä»¥ä¸‹å‘½ä»¤å¯åŠ¨ä¸­ç»§ï¼š

```sh
./grasshopper start --ci aes --co none -l "127.0.0.1:4001" -n "127.0.0.1:5000"
```

- `--ci aes`: å¯¹ä¼ å…¥çš„æ•°æ®åŒ…åº”ç”¨åŠ å¯†ã€‚
- `--co none`: å°†æ˜æ–‡è½¬å‘åˆ° `ncat` echo æœåŠ¡å™¨ã€‚

### æ­¥éª¤ 3: å¯åŠ¨åˆ°äºŒçº§ä¸­ç»§çš„ä¸€çº§ä¸­ç»§

è¿è¡Œä»¥ä¸‹å‘½ä»¤å¯åŠ¨å¦ä¸€ä¸ªä¸­ç»§ï¼š

```sh
./grasshopper start --ci none --co aes -l "127.0.0.1:4000" -n "127.0.0.1:4001"
```

- `--ci none`: å¯¹ä¼ å…¥çš„æ•°æ®åŒ…ä¸åº”ç”¨åŠ å¯†ã€‚
- `--co aes`: åŠ å¯†æ•°æ®åŒ…å¹¶å°†å…¶è½¬å‘åˆ°ä¸‹ä¸€è·³ã€‚

### æ­¥éª¤ 4: å¯åŠ¨æ¼”ç¤ºå®¢æˆ·ç«¯

ä½¿ç”¨ `ncat` å‘é€ UDP æ•°æ®åŒ…å¹¶ä¸ä¸­ç»§é“¾äº¤äº’ï¼š

```sh
ncat -u 127.0.0.1 2132
```

### æ¡ˆä¾‹ II: å®‰å…¨ DNS æŸ¥è¯¢ (éšæœºé€‰æ‹©)
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ YOURâ”€LAPTOP â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ CLOUDâ”€SERVER â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                       â”‚           â”‚                                   â”‚
â”‚                                       â”‚           â”‚                                   â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚           â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚ â”‚                   â”‚   â”‚          â”‚  â”‚           â”‚ â”‚          â”‚   â”‚               â”‚  â”‚
â”‚ â”‚ dig google.com    â”œâ”€â”€â”€â–º Level-1  â”‚  â”‚           â”‚ â”‚ Level-2  â”œâ”€â”€â”€â–º Google DNS:53 â”‚  â”‚
â”‚ â”‚ @127.0.0.1 -p 4000â”‚   â”‚ Relayer  â”¼â”€â”€â”¼ ENCRYPTED â”¼â”€â–º Relayer  â”‚   â”‚ CloudFlare:53 â”‚  â”‚
â”‚ â”‚                   â”‚   â”‚          â”‚  â”‚    UDP    â”‚ â”‚          â”‚   â”‚               â”‚  â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚           â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                       â”‚           â”‚                                   â”‚
â”‚                                       â”‚           â”‚                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```
### æ­¥éª¤ 1: å¯åŠ¨åˆ° DNS æœåŠ¡å™¨çš„äºŒçº§ä¸­ç»§ (åœ¨ä½ çš„äº‘æœåŠ¡å™¨ä¸Š ğŸ–¥ï¸)

```sh
./grasshopper start --ci aes --co none -l "CLOUD_PUBLIC_IP:4000" -n "8.8.8.8:53,1.1.1.1:53"
```

- `--ci aes`: è§£å¯†æ¥è‡ªä¸€çº§ä¸­ç»§çš„ä¼ å…¥æ•°æ®åŒ…ã€‚(`ci` ä»£è¡¨ cipher-inï¼Œå³ä¼ å…¥åŠ å¯†)
- `--co none`: å°†è§£å¯†åçš„æ˜æ–‡ DNS æŸ¥è¯¢æ•°æ®åŒ…è½¬å‘åˆ° DNS æœåŠ¡å™¨ã€‚(`co` ä»£è¡¨ cipher-outï¼Œå³ä¼ å‡ºåŠ å¯†)

### æ­¥éª¤ 2: å¯åŠ¨åˆ°äºŒçº§ä¸­ç»§çš„ä¸€çº§ä¸­ç»§ (åœ¨ä½ çš„ç¬”è®°æœ¬ç”µè„‘ä¸Š ğŸ’»)

```sh
./grasshopper start --ci none --co aes -l "127.0.0.1:4000" -n "CLOUD_PUBLIC_IP:4000"
```

- `--ci none`: ç”±äº `dig` å‘½ä»¤ä»¥æ˜æ–‡å‘é€æŸ¥è¯¢ï¼Œå› æ­¤ä¸éœ€è¦å¯¹ä¼ å…¥æ•°æ®åŒ…è¿›è¡Œè§£å¯†ã€‚
- `--co aes`: åŠ å¯†æ•°æ®åŒ…å¹¶å°†å…¶è½¬å‘åˆ°äºŒçº§ä¸­ç»§ã€‚

### æ­¥éª¤ 3: ä½¿ç”¨ `dig` æŸ¥è¯¢ä¸€çº§ä¸­ç»§ (åœ¨ä½ çš„ç¬”è®°æœ¬ç”µè„‘ä¸Š ğŸ’»)

```sh
dig google.com @127.0.0.1 -p 4000
```
